import * as THREE from 'three'
import React, { useState, Suspense, useRef, useEffect } from 'react'
import { Canvas, useFrame } from '@react-three/fiber'
import { ContactShadows } from '@react-three/drei'
import Model from './Model'
import Projects from './Projects.js'
import ReactTextTransition, { presets } from 'react-text-transition'

function Rig({ children }) {
  const ref = useRef()
  useFrame((state) => {
    ref.current.rotation.y = THREE.MathUtils.lerp(ref.current.rotation.y, (state.mouse.x * Math.PI) / 20, 0.05)
    ref.current.rotation.x = THREE.MathUtils.lerp(ref.current.rotation.x, (state.mouse.y * Math.PI) / 20, 0.05)
  })
  return <group ref={ref}>{children}</group>
}

export default function App() {
  const texts = ['Hi There !', 'Know me more !', 'Something more....']

  const paragraphs = [
    "I'am Aditya Vartak, Software Developer from India. Here are some facts about me...",
    'A Computer Science Enthusiast, an Expert level coder @CodingNinjas and a passionate self-taught Full Stack Web Developer with experience in MERN stack.',
    'My passion for software lies with dreaming up ideas and making them come true with elegant interfaces. I take great care in the experience, architecture, and code quality of the things I build.',
  ]
  const [textIndex, settextIndex] = useState(0)
  const [paragraphIndex, setparagraphIndex] = useState(0)

  useEffect(() => {
    const timer = setInterval(() => {
      settextIndex(textIndex + 1)
      setparagraphIndex(paragraphIndex + 1)
    }, 5000)

    return () => {
      clearInterval(timer)
    }
  }, [textIndex, paragraphIndex])

  return (
    <>
      <Canvas camera={{ position: [0, -10, 65], fov: 50 }} dpr={[1, 2]}>
        <pointLight position={[100, 100, 100]} intensity={0.8} />
        <hemisphereLight color="#ffffff" groundColor="#b9b9b9" position={[-7, 25, 13]} intensity={0.85} />
        <Suspense fallback={null}>
          <group position={[0, 10, 0]}>
            <Rig>
              <Model url="/compressed.glb" />
            </Rig>
            <ContactShadows
              rotation-x={Math.PI / 2}
              position={[0, -35, 0]}
              opacity={0.25}
              width={100}
              height={100}
              blur={2}
              far={50}
            />
          </group>
        </Suspense>
      </Canvas>
      <div class="overlay">
        <a id="links" href="https://github.com/adityavartak07">
          <b>Github</b>
        </a>
        <a id="links" class="middle" href="https://leetcode.com/aditya0753/">
          <b>Leetcode</b>
        </a>
        <a id="links" class="right" href="https://www.linkedin.com/in/adityavartak07/">
          <b>Linkedin</b>
        </a>

        <section>
          <section className="inline">
            <ReactTextTransition
              children={texts[textIndex % texts.length]}
              springConfig={presets.gentle}
              className="big"
              delay={300}
              inline
            />
            <br />
            <br />
            <ReactTextTransition children={paragraphs[paragraphIndex % texts.length]} springConfig={presets.gentle} />
          </section>
        </section>
      </div>
      <br />
      <Suspense fallback={null}>
        <div camera={{ position: [65, -10, 0], fov: 50 }} dpr={[1, 2]}>
          <h1>Projects</h1>
          <br />
          <Projects />
        </div>
      </Suspense>
    </>
  )
}
